<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Journal de Trading - EOC Pro</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Montserrat:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.0.2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/fr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      color: #333;
    }

    body {
      display: flex;
      min-height: 100vh;
      background-image: url('background.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      transition: all 0.3s ease;
    }

    body.dark-mode {
      background-color: #1a1a2e;
      color: #f0f0f0;
      background-image: none;
    }

    /* EOC Logo */
    .eoc-logo {
      position: fixed;
      top: 20px;
      left: 20px;
      font-family: 'Poppins', sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: #4cc9f0;
      z-index: 1000;
      display: block;
      text-shadow: 0 0 10px rgba(76, 201, 240, 0.5);
    }

    #splash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #0a1930;
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      text-align: center;
    }
    
    #splash h1 {
      font-family: 'Poppins', sans-serif;
      font-size: 5rem;
      margin-bottom: 10px;
      animation: fadeIn 2s ease;
      color: #4cc9f0;
      text-shadow: 0 0 15px rgba(76, 201, 240, 0.7);
      letter-spacing: 2px;
    }
    
    #splash p {
      font-family: 'Montserrat', sans-serif;
      font-size: 1.8rem;
      opacity: 0.9;
      margin-bottom: 30px;
      font-weight: 500;
      color: #ffffff;
    }
    
    #enterBtn {
      margin-top: 40px;
      padding: 15px 40px;
      font-size: 1.2rem;
      background: linear-gradient(135deg, #4361ee, #3a0ca3);
      color: white;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      opacity: 0;
      animation: fadeIn 1s ease 1s forwards;
      font-weight: 700;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      box-shadow: 0 5px 20px rgba(67, 97, 238, 0.5);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    #enterBtn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(67, 97, 238, 0.7);
    }
    
    #enterBtn:active {
      transform: translateY(1px);
    }
    
    #enterBtn::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.3));
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }
    
    #enterBtn:hover::after {
      transform: translateX(0);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    /* Auth Modal */
    .auth-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .auth-container {
      background-color: #1e1e2f;
      padding: 30px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    }

    .auth-container h2 {
      color: #4cc9f0;
      text-align: center;
      margin-bottom: 20px;
      font-family: 'Poppins', sans-serif;
    }

    .auth-container input {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      background-color: rgba(30, 30, 47, 0.5);
      color: white;
      font-size: 16px;
    }

    .auth-container button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #4361ee, #3a0ca3);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      margin-bottom: 15px;
      transition: all 0.3s;
    }

    .auth-container button:hover {
      opacity: 0.9;
    }

    #googleLoginBtn {
      background: linear-gradient(135deg, #4285F4, #34A853);
    }

    .switch-auth {
      color: #a1a1aa;
      text-align: center;
      margin-top: 15px;
      cursor: pointer;
      transition: color 0.3s;
    }

    .switch-auth:hover {
      color: #4cc9f0;
    }

    .error-message {
      color: #f87171;
      margin-bottom: 15px;
      text-align: center;
      font-size: 14px;
    }

    .forgot-password {
      color: #a1a1aa;
      text-align: center;
      margin-top: 10px;
      cursor: pointer;
      font-size: 14px;
      transition: color 0.3s;
    }

    .forgot-password:hover {
      color: #4cc9f0;
    }

    /* Main App */
    #mainApp {
      display: none;
      width: 100%;
      min-height: 100vh;
    }

    .user-info {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 1000;
    }

    .user-name {
      color: #333;
      font-size: 14px;
      background-color: rgba(0, 0, 0, 0.05);
      padding: 5px 10px;
      border-radius: 20px;
    }

    body.dark-mode .user-name {
      color: #f0f0f0;
      background-color: rgba(255, 255, 255, 0.1);
    }

    .logout-btn {
      background: rgba(248, 113, 113, 0.2);
      border: none;
      color: #f87171;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .logout-btn:hover {
      background: rgba(248, 113, 113, 0.4);
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: 70px;
      height: 100vh;
      background-color: rgba(255, 255, 255, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 80px;
      gap: 25px;
      z-index: 100;
      border-right: 1px solid rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .sidebar {
      background-color: rgba(30, 30, 47, 0.9);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar i {
      color: rgba(0, 0, 0, 0.7);
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s;
    }

    body.dark-mode .sidebar i {
      color: rgba(255, 255, 255, 0.7);
    }

    .sidebar i:hover {
      color: #4361ee;
      transform: scale(1.1);
    }

    .sidebar i.active {
      color: #4361ee;
    }

    /* Main Content */
    .main {
      margin-left: 70px;
      padding: 20px;
      width: calc(100% - 70px);
      min-height: 100vh;
    }

    .section {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .section.active {
      display: block;
    }

    /* Dashboard Section */
    #dashboard-section {
      max-width: 1200px;
      margin: 0 auto;
    }

    #dashboard-section h3 {
      color: #333;
      margin-bottom: 20px;
      font-size: 24px;
      font-weight: 600;
    }

    body.dark-mode #dashboard-section h3 {
      color: #f0f0f0;
    }

    .trade-form {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .trade-form {
      background-color: rgba(30, 30, 47, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }

    .form-group {
      flex: 1;
      min-width: 200px;
    }

    .form-group label {
      display: block;
      color: rgba(0, 0, 0, 0.7);
      margin-bottom: 5px;
      font-size: 14px;
    }

    body.dark-mode .form-group label {
      color: rgba(255, 255, 255, 0.7);
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px 15px;
      border-radius: 5px;
      border: 1px solid #ddd;
      background-color: white;
      color: #333;
    }

    body.dark-mode .form-group input,
    body.dark-mode .form-group select {
      background-color: rgba(40, 40, 60, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #f0f0f0;
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }

    .form-actions button {
      padding: 10px 20px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
    }

    #saveTradeBtn {
      background-color: #4361ee;
      color: white;
    }

    #saveTradeBtn:hover {
      background-color: #3a56d4;
    }

    #resetFormBtn {
      background-color: rgba(0, 0, 0, 0.1);
      color: #333;
    }

    body.dark-mode #resetFormBtn {
      background-color: rgba(255, 255, 255, 0.1);
      color: #f0f0f0;
    }

    #resetFormBtn:hover {
      background-color: rgba(0, 0, 0, 0.2);
    }

    body.dark-mode #resetFormBtn:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }

    /* Trade Table */
    .trade-table-container {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      overflow-x: auto;
    }

    body.dark-mode .trade-table-container {
      background-color: rgba(30, 30, 47, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    #tradeTable {
      width: 100%;
      border-collapse: collapse;
      color: #333;
    }

    body.dark-mode #tradeTable {
      color: #f0f0f0;
    }

    #tradeTable th {
      text-align: left;
      padding: 12px 15px;
      background-color: rgba(67, 97, 238, 0.1);
      font-weight: 500;
    }

    body.dark-mode #tradeTable th {
      background-color: rgba(67, 97, 238, 0.2);
    }

    #tradeTable td {
      padding: 12px 15px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    body.dark-mode #tradeTable td {
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    #tradeTable tr:hover {
      background-color: rgba(0, 0, 0, 0.03);
    }

    body.dark-mode #tradeTable tr:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }

    .badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }

    .badge.buy {
      background-color: rgba(74, 222, 128, 0.2);
      color: #4ade80;
    }

    .badge.sell {
      background-color: rgba(248, 113, 113, 0.2);
      color: #f87171;
    }

    .badge.win {
      background-color: rgba(74, 222, 128, 0.2);
      color: #4ade80;
    }

    .badge.loss {
      background-color: rgba(248, 113, 113, 0.2);
      color: #f87171;
    }

    .profit {
      color: #4ade80;
    }

    .loss {
      color: #f87171;
    }

    /* Filters */
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
    }

    .filter-group {
      flex: 1;
      min-width: 200px;
    }

    .filter-group label {
      display: block;
      color: rgba(0, 0, 0, 0.7);
      margin-bottom: 5px;
      font-size: 14px;
    }

    body.dark-mode .filter-group label {
      color: rgba(255, 255, 255, 0.7);
    }

    .filter-group input,
    .filter-group select {
      width: 100%;
      padding: 10px 15px;
      border-radius: 5px;
      border: 1px solid #ddd;
      background-color: white;
      color: #333;
    }

    body.dark-mode .filter-group input,
    body.dark-mode .filter-group select {
      background-color: rgba(40, 40, 60, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #f0f0f0;
    }

    /* Stats */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .stat-card {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .stat-card {
      background-color: rgba(30, 30, 47, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-card h4 {
      color: rgba(0, 0, 0, 0.7);
      font-size: 14px;
      margin-bottom: 10px;
      font-weight: 500;
    }

    body.dark-mode .stat-card h4 {
      color: rgba(255, 255, 255, 0.7);
    }

    .stat-card p {
      color: #333;
      font-size: 24px;
      font-weight: 600;
    }

    body.dark-mode .stat-card p {
      color: #f0f0f0;
    }

    /* Journal Actions */
    .journal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-bottom: 20px;
    }

    .journal-actions button {
      padding: 10px 20px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #saveJournalBtn {
      background-color: #4361ee;
      color: white;
    }

    #saveJournalBtn:hover {
      background-color: #3a56d4;
    }

    #resetJournalBtn {
      background-color: rgba(248, 113, 113, 0.2);
      color: #f87171;
    }

    #resetJournalBtn:hover {
      background-color: rgba(248, 113, 113, 0.3);
    }

    #exportCSVBtn {
      background-color: rgba(74, 222, 128, 0.2);
      color: #4ade80;
    }

    #exportCSVBtn:hover {
      background-color: rgba(74, 222, 128, 0.3);
    }

    #exportExcelBtn {
      background-color: rgba(234, 179, 8, 0.2);
      color: #eab308;
    }

    #exportExcelBtn:hover {
      background-color: rgba(234, 179, 8, 0.3);
    }

    #importTradesBtn {
      background-color: rgba(139, 92, 246, 0.2);
      color: #8b5cf6;
    }

    #importTradesBtn:hover {
      background-color: rgba(139, 92, 246, 0.3);
    }

    /* Performance Section */
    #performance-section {
      max-width: 1200px;
      margin: 0 auto;
    }

    #performance-section h1 {
      color: #333;
      margin-bottom: 30px;
      font-size: 28px;
      font-weight: 600;
    }

    body.dark-mode #performance-section h1 {
      color: #f0f0f0;
    }

    .charts-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    @media (min-width: 992px) {
      .charts-container {
        grid-template-columns: 2fr 1fr;
      }
    }

    .chart-card {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .chart-card {
      background-color: rgba(30, 30, 47, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .chart-card h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 18px;
      font-weight: 600;
    }

    body.dark-mode .chart-card h2 {
      color: #f0f0f0;
    }

    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
    }

    .performance-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .performance-stat {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .performance-stat {
      background-color: rgba(30, 30, 47, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .performance-stat h3 {
      color: rgba(0, 0, 0, 0.7);
      font-size: 14px;
      margin-bottom: 10px;
      font-weight: 500;
    }

    body.dark-mode .performance-stat h3 {
      color: rgba(255, 255, 255, 0.7);
    }

    .performance-stat p {
      color: #333;
      font-size: 24px;
      font-weight: 600;
    }

    body.dark-mode .performance-stat p {
      color: #f0f0f0;
    }

    /* Emotional Patterns */
    .emotional-patterns {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    body.dark-mode .emotional-patterns {
      background-color: rgba(30, 30, 47, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .emotional-patterns h2 {
      color: #333;
      margin-bottom: 15px;
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    body.dark-mode .emotional-patterns h2 {
      color: #f0f0f0;
    }

    .emotional-patterns h2 i {
      color: #4cc9f0;
    }

    #emotionalPatternText {
      color: rgba(0, 0, 0, 0.9);
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 15px;
    }

    body.dark-mode #emotionalPatternText {
      color: rgba(255, 255, 255, 0.9);
    }

    .emotional-patterns button {
      padding: 8px 15px;
      background-color: rgba(76, 201, 240, 0.2);
      color: #4cc9f0;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
    }

    .emotional-patterns button:hover {
      background-color: rgba(76, 201, 240, 0.3);
    }

    /* Daily Feedback */
    .daily-feedback {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .daily-feedback {
      background-color: rgba(30, 30, 47, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .daily-feedback h2 {
      color: #333;
      margin-bottom: 15px;
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    body.dark-mode .daily-feedback h2 {
      color: #f0f0f0;
    }

    .daily-feedback h2 i {
      color: #8b5cf6;
    }

    #dailyFeedbackText {
      color: rgba(0, 0, 0, 0.9);
      font-size: 16px;
      line-height: 1.6;
    }

    body.dark-mode #dailyFeedbackText {
      color: rgba(255, 255, 255, 0.9);
    }

    /* Calendar Section */
    #calendar-section {
      max-width: 1200px;
      margin: 0 auto;
    }

    #calendar-section h1 {
      color: #333;
      margin-bottom: 30px;
      font-size: 28px;
      font-weight: 600;
    }

    body.dark-mode #calendar-section h1 {
      color: #f0f0f0;
    }

    #calendar {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    body.dark-mode #calendar {
      background-color: rgba(30, 30, 47, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Brokers Section */
    #brokers-section {
      max-width: 1200px;
      margin: 0 auto;
    }

    #brokers-section h1 {
      color: #333;
      margin-bottom: 30px;
      font-size: 28px;
      font-weight: 600;
    }

    body.dark-mode #brokers-section h1 {
      color: #f0f0f0;
    }

    .brokers-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .broker-card {
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .broker-card {
      background-color: rgba(30, 30, 47, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .broker-header {
      padding: 15px 20px;
      background-color: rgba(67, 97, 238, 0.1);
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .broker-header {
      background-color: rgba(67, 97, 238, 0.2);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .broker-header h3 {
      color: #333;
      font-size: 18px;
      margin-bottom: 5px;
    }

    body.dark-mode .broker-header h3 {
      color: #f0f0f0;
    }

    .broker-header p {
      color: rgba(0, 0, 0, 0.7);
      font-size: 14px;
    }

    body.dark-mode .broker-header p {
      color: rgba(255, 255, 255, 0.7);
    }

    .broker-body {
      padding: 20px;
    }

    .broker-feature {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .broker-feature i {
      color: #4cc9f0;
      font-size: 16px;
    }

    .broker-feature p {
      color: rgba(0, 0, 0, 0.8);
      font-size: 14px;
    }

    body.dark-mode .broker-feature p {
      color: rgba(255, 255, 255, 0.8);
    }

    .broker-rating {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-top: 20px;
    }

    .broker-rating i {
      color: #eab308;
      font-size: 16px;
    }

    .broker-actions {
      margin-top: 20px;
    }

    .broker-actions a {
      display: inline-block;
      padding: 8px 15px;
      background-color: rgba(67, 97, 238, 0.2);
      color: #4361ee;
      border-radius: 5px;
      text-decoration: none;
      font-size: 14px;
      transition: all 0.3s;
    }

    body.dark-mode .broker-actions a {
      background-color: rgba(67, 97, 238, 0.3);
      color: #f0f0f0;
    }

    .broker-actions a:hover {
      background-color: rgba(67, 97, 238, 0.4);
    }

    /* Notes Section */
    #notes-section {
      max-width: 1200px;
      margin: 0 auto;
    }

    .notes-container {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      margin-bottom: 20px;
      border: 1px solid rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }

    body.dark-mode .notes-container {
      background-color: rgba(30, 30, 47, 0.9);
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 2px 10px rgba(0,0,0,0.4);
    }

    .notes-container h2 {
      margin-bottom: 15px;
      color: #333;
      transition: all 0.3s ease;
    }

    body.dark-mode .notes-container h2 {
      color: #f0f0f0;
    }

    #notesEditor {
      width: 100%;
      min-height: 300px;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #ddd;
      background-color: white;
      color: #333;
      font-size: 16px;
      line-height: 1.6;
      resize: vertical;
      transition: all 0.3s ease;
    }

    body.dark-mode #notesEditor {
      background-color: rgba(40, 40, 60, 0.9);
      color: #f0f0f0;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .notes-toolbar {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .notes-toolbar button {
      padding: 8px 15px;
      border-radius: 5px;
      border: none;
      background-color: #4361ee;
      color: white;
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .notes-toolbar button:hover {
      background-color: #3a56d4;
    }

    .notes-toolbar button i {
      font-size: 14px;
    }

    /* Notes Preview */
    #notesPreview {
      color: #333;
      font-size: 16px;
      line-height: 1.6;
    }

    body.dark-mode #notesPreview {
      color: #f0f0f0;
    }

    /* Emoji Picker Styles */
    .emoji-picker {
      position: absolute;
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      z-index: 1000;
      display: none;
      max-width: 300px;
      max-height: 200px;
      overflow-y: auto;
    }

    body.dark-mode .emoji-picker {
      background-color: #1e1e2f;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .emoji-picker span {
      font-size: 20px;
      padding: 5px;
      cursor: pointer;
      display: inline-block;
    }

    .emoji-picker span:hover {
      transform: scale(1.2);
    }

    /* Settings Section */
    #settings-section {
      max-width: 1200px;
      margin: 0 auto;
    }

    #settings-section h1 {
      color: #333;
      margin-bottom: 30px;
      font-size: 28px;
      font-weight: 600;
    }

    body.dark-mode #settings-section h1 {
      color: #f0f0f0;
    }

    .settings-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }

    @media (min-width: 768px) {
      .settings-container {
        grid-template-columns: 1fr 1fr;
      }
    }

    .settings-card {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .settings-card {
      background-color: rgba(30, 30, 47, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .settings-card h2 {
      color: #333;
      margin-bottom: 20px;
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    body.dark-mode .settings-card h2 {
      color: #f0f0f0;
    }

    .settings-card h2 i {
      color: #4cc9f0;
    }

    .setting-group {
      margin-bottom: 20px;
    }

    .setting-group label {
      display: block;
      color: rgba(0, 0, 0, 0.7);
      margin-bottom: 10px;
      font-size: 14px;
    }

    body.dark-mode .setting-group label {
      color: rgba(255, 255, 255, 0.7);
    }

    .setting-group input[type="number"] {
      width: 100%;
      padding: 10px 15px;
      border-radius: 5px;
      border: 1px solid #ddd;
      background-color: white;
      color: #333;
    }

    body.dark-mode .setting-group input[type="number"] {
      background-color: rgba(40, 40, 60, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #f0f0f0;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.1);
      transition: .4s;
      border-radius: 24px;
    }

    body.dark-mode .toggle-slider {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: #4361ee;
    }

    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }

    .language-options {
      display: flex;
      gap: 10px;
    }

    .language-option {
      padding: 8px 15px;
      border-radius: 5px;
      background-color: rgba(0, 0, 0, 0.1);
      color: #333;
      cursor: pointer;
      transition: all 0.3s;
    }

    body.dark-mode .language-option {
      background-color: rgba(255, 255, 255, 0.1);
      color: #f0f0f0;
    }

    .language-option.active {
      background-color: #4361ee;
      color: white;
    }

    .language-option:hover:not(.active) {
      background-color: rgba(0, 0, 0, 0.2);
    }

    body.dark-mode .language-option:hover:not(.active) {
      background-color: rgba(255, 255, 255, 0.2);
    }

    /* Capital Initial Form */
    .capital-form {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .capital-form input {
      width: 100px;
      padding: 8px 12px;
      border-radius: 5px;
      border: 1px solid #ddd;
    }

    body.dark-mode .capital-form input {
      background-color: rgba(40, 40, 60, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #f0f0f0;
    }

    .capital-form button {
      padding: 8px 15px;
      background-color: rgba(76, 201, 240, 0.2);
      color: #4cc9f0;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .capital-form button:hover {
      background-color: rgba(76, 201, 240, 0.3);
    }

    /* Welcome Message */
    .welcome-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      z-index: 1001;
      max-width: 500px;
      width: 90%;
      text-align: center;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .welcome-message {
      background-color: #1e1e2f;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .welcome-message h2 {
      color: #4361ee;
      margin-bottom: 15px;
      font-size: 24px;
    }

    .welcome-message p {
      color: rgba(0, 0, 0, 0.8);
      margin-bottom: 20px;
      line-height: 1.6;
    }

    body.dark-mode .welcome-message p {
      color: rgba(255, 255, 255, 0.8);
    }

    .welcome-message button {
      padding: 10px 20px;
      background-color: #4361ee;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
    }

    .welcome-message button:hover {
      background-color: #3a56d4;
    }

    /* Non-logged message */
    .non-logged-message {
      background-color: rgba(255, 255, 255, 0.9);
      padding: 40px 20px;
      border-radius: 10px;
      text-align: center;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .non-logged-message {
      background-color: rgba(30, 30, 47, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .non-logged-message h2 {
      color: #333;
      margin-bottom: 15px;
      font-size: 24px;
    }

    body.dark-mode .non-logged-message h2 {
      color: #f0f0f0;
    }

    .non-logged-message p {
      color: rgba(0, 0, 0, 0.8);
      margin-bottom: 25px;
      line-height: 1.6;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }

    body.dark-mode .non-logged-message p {
      color: rgba(255, 255, 255, 0.8);
    }

    .non-logged-message button {
      padding: 12px 25px;
      background-color: #4361ee;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
    }

    .non-logged-message button:hover {
      background-color: #3a56d4;
    }

    /* File input (hidden) */
    #fileInput {
      display: none;
    }

    /* Password Reset Modal */
    .reset-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .reset-container {
      background-color: #1e1e2f;
      padding: 30px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    }

    .reset-container h2 {
      color: #4cc9f0;
      text-align: center;
      margin-bottom: 20px;
      font-family: 'Poppins', sans-serif;
    }

    .reset-container input {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      background-color: rgba(30, 30, 47, 0.5);
      color: white;
      font-size: 16px;
    }

    .reset-container button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #4361ee, #3a0ca3);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      margin-bottom: 15px;
      transition: all 0.3s;
    }

    .reset-container button:hover {
      opacity: 0.9;
    }

    #resetError {
      color: #f87171;
      margin-bottom: 15px;
      text-align: center;
      font-size: 14px;
    }

    .back-to-login {
      color: #a1a1aa;
      text-align: center;
      margin-top: 15px;
      cursor: pointer;
      transition: color 0.3s;
    }

    .back-to-login:hover {
      color: #4cc9f0;
    }
  </style>
</head>
<body>
  <!-- EOC Logo (always visible) -->
  <div class="eoc-logo">EOC</div>

  <div id="splash">
    <h1>EOC</h1>
    <p>Bienvenue dans ton Journal de Trading</p>
    <button id="enterBtn">Welcome</button>
  </div>

  <!-- Auth Modal -->
  <div id="authModal" class="auth-modal">
    <div class="auth-container">
      <div id="loginView">
        <h2>CONNEXION</h2>
        <div id="loginError" class="error-message"></div>
        <input type="email" id="loginEmail" placeholder="Email">
        <input type="password" id="loginPassword" placeholder="Mot de passe">
        <button id="loginBtn">Se connecter</button>
        <button id="googleLoginBtn">Se connecter avec Google</button>
        <div class="forgot-password" id="forgotPassword">Mot de passe oublié ?</div>
        <div class="switch-auth" id="showRegister">Créer un compte</div>
      </div>
      
      <div id="registerView" style="display: none;">
        <h2>CRÉER UN COMPTE</h2>
        <div id="registerError" class="error-message"></div>
        <input type="text" id="registerUsername" placeholder="Nom d'utilisateur">
        <input type="email" id="registerEmail" placeholder="Email">
        <input type="password" id="registerPassword" placeholder="Mot de passe (6 caractères min)">
        <input type="password" id="registerConfirmPassword" placeholder="Confirmer le mot de passe">
        <button id="registerBtn">S'inscrire</button>
        <div class="switch-auth" id="showLogin">Déjà un compte ? Se connecter</div>
      </div>
    </div>
  </div>

  <!-- Password Reset Modal -->
  <div id="resetModal" class="reset-modal">
    <div class="reset-container">
      <h2>RÉINITIALISER LE MOT DE PASSE</h2>
      <div id="resetError" class="error-message"></div>
      <input type="email" id="resetEmail" placeholder="Email">
      <button id="resetBtn">Envoyer le lien de réinitialisation</button>
      <div class="back-to-login" id="backToLogin">Retour à la connexion</div>
    </div>
  </div>

  <div id="mainApp" style="display: none;">
    <div class="user-info">
      <span class="user-name" id="userName"></span>
      <button class="logout-btn" id="logoutBtn"><i class="fas fa-sign-out-alt"></i></button>
    </div>

    <div class="sidebar">
      <i class="fas fa-tachometer-alt active" data-section="dashboard"></i>
      <i class="fas fa-chart-bar" data-section="performance"></i>
      <i class="fas fa-calendar-alt" data-section="calendar"></i>
      <i class="fas fa-building" data-section="brokers"></i>
      <i class="fas fa-sticky-note" data-section="notes"></i>
      <i class="fas fa-cog" data-section="settings"></i>
    </div>

    <div class="main">
      <!-- Dashboard Section -->
      <section id="dashboard-section" class="section active">
        <div id="nonLoggedMessage" class="non-logged-message" style="display: none;">
          <h2>Connectez-vous pour accéder à votre journal</h2>
          <p>Veuillez vous connecter ou créer un compte pour enregistrer et suivre vos trades.</p>
          <button id="loginFromAppBtn">Se connecter</button>
        </div>

        <div id="loggedContent" style="display: none;">
          <h3>AJOUTER UN TRADE</h3>
          
          <div class="trade-form">
            <div class="form-row">
              <div class="form-group">
                <label for="tradeDate">Date</label>
                <input type="text" id="tradeDate" class="date-input" placeholder="YYYY-MM-DD">
              </div>
              <div class="form-group">
                <label for="tradeSymbol">Symbole</label>
                <input type="text" id="tradeSymbol" placeholder="EURUSD, AAPL, BTCUSD...">
              </div>
              <div class="form-group">
                <label for="tradeType">Type</label>
                <select id="tradeType">
                  <option value="Buy">Achat</option>
                  <option value="Sell">Vente</option>
                </select>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="tradeEntry">Prix d'entrée</label>
                <input type="number" id="tradeEntry" step="0.0001" placeholder="1.1234">
              </div>
              <div class="form-group">
                <label for="tradeExit">Prix de sortie</label>
                <input type="number" id="tradeExit" step="0.0001" placeholder="1.1256">
              </div>
              <div class="form-group">
                <label for="tradeLot">Taille (lot)</label>
                <input type="number" id="tradeLot" step="0.01" placeholder="0.10">
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="tradeResult">Résultat</label>
                <select id="tradeResult">
                  <option value="win">Gagné</option>
                  <option value="loss">Perdu</option>
                </select>
              </div>
              <div class="form-group">
                <label for="tradePL">Profit/Perte ($)</label>
                <input type="number" id="tradePL" step="0.01" placeholder="25.50">
              </div>
              <div class="form-group">
                <label for="tradeRR">Ratio R/R</label>
                <input type="number" id="tradeRR" step="0.01" placeholder="1.50" readonly>
              </div>
            </div>
            
            <div class="form-actions">
              <button id="resetFormBtn">Réinitialiser</button>
              <button id="saveTradeBtn" onclick="saveTrade()">Enregistrer</button>
            </div>
          </div>
          
          <div class="filters">
            <div class="filter-group">
              <label for="symbolFilter">Symbole</label>
              <input type="text" id="symbolFilter" placeholder="Filtrer par symbole" oninput="filterTrades()">
            </div>
            <div class="filter-group">
              <label for="dateFromFilter">De</label>
              <input type="text" id="dateFromFilter" class="date-filter" placeholder="Date de début" onchange="filterTrades()">
            </div>
            <div class="filter-group">
              <label for="dateToFilter">À</label>
              <input type="text" id="dateToFilter" class="date-filter" placeholder="Date de fin" onchange="filterTrades()">
            </div>
            <div class="filter-group">
              <label for="resultFilter">Résultat</label>
              <select id="resultFilter" onchange="filterTrades()">
                <option value="all">Tous</option>
                <option value="win">Gagnés</option>
                <option value="loss">Perdus</option>
              </select>
            </div>
          </div>
          
          <div class="trade-table-container">
            <table id="tradeTable">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Symbole</th>
                  <th>Type</th>
                  <th>Entry</th>
                  <th>Exit</th>
                  <th>Lot</th>
                  <th>Résultat</th>
                  <th>P&L</th>
                  <th>R/R</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <!-- Trades will be inserted here -->
              </tbody>
            </table>
          </div>
          
          <div class="stats-container">
            <div class="stat-card">
              <h4>Nombre de trades</h4>
              <p id="totalTrades">0</p>
            </div>
            <div class="stat-card">
              <h4>Taux de réussite</h4>
              <p id="winRate">0%</p>
            </div>
            <div class="stat-card">
              <h4>Profit total</h4>
              <p id="totalProfit">$0.00</p>
            </div>
            <div class="stat-card">
              <h4>R/R moyen</h4>
              <p id="averageRRR">0.00</p>
            </div>
            <div class="stat-card">
              <h4>Capital initial</h4>
              <p><input type="number" id="initialCapital" value="1000" step="100" style="width: 80px; background: transparent; border: none; color: #333; font-size: 24px; font-weight: 600;" onchange="updateCapital()"> $</p>
            </div>
            <div class="stat-card">
              <h4>Capital actuel</h4>
              <p id="currentCapital">$1000.00</p>
            </div>
          </div>
          
          <div class="journal-actions">
            <button id="importTradesBtn" onclick="importFromFile()"><i class="fas fa-file-import"></i> Importer</button>
            <input type="file" id="fileInput" accept=".xlsx,.xls,.csv">
            <button id="exportCSVBtn" onclick="exportToCSV()"><i class="fas fa-file-csv"></i> CSV</button>
            <button id="exportExcelBtn" onclick="exportToExcel()"><i class="fas fa-file-excel"></i> Excel</button>
            <button id="resetJournalBtn" onclick="resetJournal()"><i class="fas fa-trash-alt"></i> Réinitialiser</button>
            <button id="saveJournalBtn" onclick="saveJournal()"><i class="fas fa-save"></i> Sauvegarder</button>
          </div>
        </div>
      </section>

      <!-- Performance Section -->
      <section id="performance-section" class="section">
        <div id="nonLoggedMessagePerformance" class="non-logged-message" style="display: none;">
          <h2>Connectez-vous pour accéder à l'analyse de performance</h2>
          <p>Veuillez vous connecter ou créer un compte pour visualiser vos statistiques de trading.</p>
          <button id="loginFromPerformanceBtn">Se connecter</button>
        </div>

        <div id="loggedContentPerformance" style="display: none;">
          <h1>ANALYSE DE PERFORMANCE</h1>
          
          <div class="charts-container">
            <div class="chart-card">
              <h2>Évolution du capital</h2>
              <div class="chart-container">
                <canvas id="capitalChart"></canvas>
              </div>
            </div>
            
            <div class="chart-card">
              <h2>Trades gagnants vs perdants</h2>
              <div class="chart-container">
                <canvas id="pieChart"></canvas>
              </div>
            </div>
          </div>
          
          <div class="performance-stats">
            <div class="performance-stat">
              <h3>Ratio Risk/Reward moyen</h3>
              <p id="avgRiskReward">0.00</p>
            </div>
            <div class="performance-stat">
              <h3>Max Drawdown</h3>
              <p id="maxDrawdown">$0.00</p>
            </div>
            <div class="performance-stat">
              <h3>Plus grosse perte quotidienne</h3>
              <p id="maxDailyLoss">$0.00</p>
            </div>
            <div class="performance-stat">
              <h3>Plus gros gain quotidien</h3>
              <p id="maxDailyWin">$0.00</p>
            </div>
          </div>
          
          <div class="chart-card">
            <h2>Performance quotidienne</h2>
            <div class="chart-container">
              <canvas id="dailyChart"></canvas>
            </div>
          </div>
          
          <div class="emotional-patterns">
            <h2><i class="fas fa-brain"></i> Pattern Émotionnel</h2>
            <p id="emotionalPatternText">Le capital c'est ton oxygène. Protège-le.</p>
            <button onclick="showNextEmotionalPattern()">Suivant</button>
          </div>
          
          <div class="daily-feedback">
            <h2><i class="fas fa-comment-dots"></i> Feedback Quotidien</h2>
            <p id="dailyFeedbackText">Analyse tes trades perdants pour identifier les patterns à éviter.</p>
          </div>
        </div>
      </section>

      <!-- Calendar Section -->
      <section id="calendar-section" class="section">
        <div id="nonLoggedMessageCalendar" class="non-logged-message" style="display: none;">
          <h2>Connectez-vous pour accéder au calendrier</h2>
          <p>Veuillez vous connecter ou créer un compte pour visualiser vos trades sur le calendrier.</p>
          <button id="loginFromCalendarBtn">Se connecter</button>
        </div>

        <div id="loggedContentCalendar" style="display: none;">
          <h1><i class="fas fa-calendar-alt"></i> CALENDRIER DES TRADES</h1>
          <div id="calendar"></div>
        </div>
      </section>

      <!-- Brokers Section -->
      <section id="brokers-section" class="section">
        <div id="nonLoggedMessageBrokers" class="non-logged-message" style="display: none;">
          <h2>Connectez-vous pour accéder aux recommandations de brokers</h2>
          <p>Veuillez vous connecter ou créer un compte pour voir nos recommandations.</p>
          <button id="loginFromBrokersBtn">Se connecter</button>
        </div>

        <div id="loggedContentBrokers" style="display: none;">
          <h1>RECOMMANDATION DE BROKERS</h1>
          
          <div class="brokers-container">
            <div class="broker-card">
              <div class="broker-header">
                <h3>EXNESS</h3>
                <p>Broker régulé avec spreads serrés</p>
              </div>
              <div class="broker-body">
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Spreads à partir de 0.0 pips</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Exécution ultra-rapide</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Plateformes avancées (MT4, MT5)</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Leverage jusqu'à 1:2000</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Support client 24/7</p>
                </div>
                <div class="broker-actions">
                  <a href="https://one.exnesstrack.org/a/i911hyordj" target="_blank">Ouvrir un compte</a>
                </div>
              </div>
            </div>
            
            <div class="broker-card">
              <div class="broker-header">
                <h3>LITEFINANCE</h3>
                <p>Broker fiable avec conditions favorables</p>
              </div>
              <div class="broker-body">
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Spreads à partir de 0.0 pips</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Exécution rapide</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Plateformes conviviales (MT4, MT5)</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Leverage jusqu'à 1:500</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Support client 24/5</p>
                </div>
                <div class="broker-actions">
                  <a href="https://www.litefinance.org/?uid=114959820" target="_blank">Ouvrir un compte</a>
                </div>
              </div>
            </div>
            
            <div class="broker-card">
              <div class="broker-header">
                <h3>HEADWAY</h3>
                <p>Broker innovant avec cashback</p>
              </div>
              <div class="broker-body">
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Cashback sur chaque trade</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Spreads compétitifs</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Plateformes MT4/MT5</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Leverage jusqu'à 1:500</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Support client 24/5</p>
                </div>
                <div class="broker-actions">
                  <a href="https://headway.partners/user/signup?hwp=2107f0" target="_blank">Ouvrir un compte</a>
                </div>
              </div>
            </div>

            <div class="broker-card">
              <div class="broker-header">
                <h3>FBS</h3>
                <p>Broker international avec bonus</p>
              </div>
              <div class="broker-body">
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Bonus de bienvenue</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Spreads compétitifs</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Plateformes MT4/MT5</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Leverage jusqu'à 1:3000</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Support client 24/7</p>
                </div>
                <div class="broker-actions">
                  <a href="https://fbs.partners?ibl=891392&ibp=25515221" target="_blank">Ouvrir un compte</a>
                </div>
              </div>
            </div>

            <div class="broker-card">
              <div class="broker-header">
                <h3>ROBOFOREX</h3>
                <p>Broker avec copy trading</p>
              </div>
              <div class="broker-body">
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Copy trading disponible</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Spreads à partir de 0 pips</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Plateformes avancées (MT4, MT5, cTrader)</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Leverage jusqu'à 1:2000</p>
                </div>
                <div class="broker-feature">
                  <i class="fas fa-check"></i>
                  <p>Support client 24/5</p>
                </div>
                <div class="broker-actions">
                  <a href="https://my.roboforex.com/en/?a=eqylm" target="_blank">Ouvrir un compte</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Notes Section -->
      <section id="notes-section" class="section">
        <div id="nonLoggedMessageNotes" class="non-logged-message" style="display: none;">
          <h2>Connectez-vous pour accéder aux notes</h2>
          <p>Veuillez vous connecter ou créer un compte pour enregistrer vos notes personnelles.</p>
          <button id="loginFromNotesBtn">Se connecter</button>
        </div>

        <div id="loggedContentNotes" style="display: none;">
          <h1><i class="fas fa-sticky-note"></i> MES NOTES</h1>
          
          <div class="notes-container">
            <h2>ÉDITEUR DE NOTES</h2>
            <div class="notes-toolbar">
              <button onclick="formatText('bold')"><i class="fas fa-bold"></i> Gras</button>
              <button onclick="formatText('italic')"><i class="fas fa-italic"></i> Italique</button>
              <button onclick="formatText('underline')"><i class="fas fa-underline"></i> Souligné</button>
              <button onclick="insertEmoji()"><i class="far fa-smile"></i> Emoji</button>
              <button onclick="clearNotes()"><i class="fas fa-trash-alt"></i> Effacer</button>
              <button onclick="saveNotes()" class="save-btn"><i class="fas fa-save"></i> Sauvegarder</button>
            </div>
            
            <div class="emoji-picker" id="emojiPicker"></div>
            
            <textarea id="notesEditor" placeholder="Écrivez ici tout ce que vous voulez : vos pensées, sentiments, analyses de marché, plans de trading..."></textarea>
          </div>
          
          <div class="notes-container">
            <h2>PRÉVISUALISATION</h2>
            <div id="notesPreview" style="padding: 15px; border-radius: 8px; background-color: rgba(0, 0, 0, 0.05); min-height: 100px; white-space: pre-wrap;"></div>
          </div>
        </div>
      </section>

      <!-- Settings Section -->
      <section id="settings-section" class="section">
        <div id="nonLoggedMessageSettings" class="non-logged-message" style="display: none;">
          <h2>Connectez-vous pour accéder aux paramètres</h2>
          <p>Veuillez vous connecter ou créer un compte pour personnaliser votre expérience.</p>
          <button id="loginFromSettingsBtn">Se connecter</button>
        </div>

        <div id="loggedContentSettings" style="display: none;">
          <h1>PARAMÈTRES</h1>
          
          <div class="settings-container">
            <div class="settings-card">
              <h2><i class="fas fa-palette"></i> Apparence</h2>
              
              <div class="setting-group">
                <label>Mode sombre</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="darkModeToggle" checked onchange="toggleDarkMode()">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="setting-group">
                <label>Langue</label>
                <div class="language-options">
                  <div class="language-option active" data-lang="fr" onclick="changeLanguage('fr')">Français</div>
                  <div class="language-option" data-lang="en" onclick="changeLanguage('en')">English</div>
                </div>
              </div>

              <div class="setting-group">
                <label>Capital initial ($)</label>
                <div class="capital-form">
                  <input type="number" id="initialCapitalSetting" value="1000" step="100">
                  <button onclick="updateCapitalFromSettings()">Mettre à jour</button>
                </div>
              </div>
            </div>
            
            <div class="settings-card">
              <h2><i class="fas fa-user-cog"></i> Compte</h2>
              
              <div class="setting-group">
                <label>Nom d'utilisateur</label>
                <p id="userNameDisplay" style="color: #333;"></p>
              </div>

              <div class="setting-group">
                <label>Email</label>
                <p id="userEmailDisplay" style="color: #333;"></p>
              </div>
              
              <div class="setting-group">
                <label>Changer de mot de passe</label>
                <button style="padding: 8px 15px; background-color: rgba(76, 201, 240, 0.2); color: #4cc9f0; border: none; border-radius: 5px; cursor: pointer;">Modifier</button>
              </div>
              
              <div class="setting-group">
                <label>Supprimer le compte</label>
                <button style="padding: 8px 15px; background-color: rgba(248, 113, 113, 0.2); color: #f87171; border: none; border-radius: 5px; cursor: pointer;">Supprimer</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Welcome Message Modal -->
  <div id="welcomeMessage" class="welcome-message" style="display: none;">
    <h2 id="welcomeTitle">Bienvenue !</h2>
    <p id="welcomeText">Vous êtes maintenant connecté à votre journal de trading.</p>
    <button id="closeWelcomeBtn">Commencer</button>
  </div>

  <!-- Trade Details Modal -->
  <div class="modal fade" id="tradeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content" style="background-color: white; color: #333;">
        <div class="modal-header">
          <h5 class="modal-title">Détails du Trade</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="tradeModalBody">
          <!-- Trade details will be inserted here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyArp7tg8vG9LALidofLGMyPLo0_kkf5Gvw",
      authDomain: "eoc-tradingjournal.firebaseapp.com",
      projectId: "eoc-tradingjournal",
      storageBucket: "eoc-tradingjournal.appspot.com",
      messagingSenderId: "1040650682872",
      appId: "1:1040650682872:web:97ec728bfee0577ce2160d"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Variables globales
    let trades = [];
    let allTrades = [];
    let capitalChart, pieChart, dailyChart;
    let currentSection = 'dashboard';
    let initialCapital = 1000;
    let currentLanguage = 'fr';
    let darkMode = true;
    let emotionalPatternIndex = 0;
    let emotionalPatternInterval;
    let lastDailyFeedbackDate = null;
    let currentUser = null;

    // Patterns émotionnels
    const emotionalPatterns = [
      "Le capital c'est ton oxygène. Protège-le.",
      "Si tu n'es pas sûr, ne trade pas. L'inaction est parfois la meilleure décision.",
      "3 pertes d'affilée ? Pause. Reviens l'esprit clair.",
      "La patience paie. Ne cours pas après le marché.",
      "Le journal est ton miroir : il révèle la vérité.",
      "Moins de trades, mais de meilleure qualité.",
      "Le FOMO est ton ennemi, reste maître de toi.",
      "Tu ne peux pas contrôler le marché, mais tu peux contrôler tes actions."
    ];

    // Feedbacks quotidiens
    const dailyFeedbacks = [
      "Analyse tes trades perdants pour identifier les patterns à éviter.",
      "Félicitations pour ta discipline ! Continue sur cette voie.",
      "Ton win rate est en hausse, c'est excellent !",
      "Attention à ne pas sur-trader aujourd'hui. Qualité plutôt que quantité.",
      "Tes trades ont un bon ratio risk/reward, continue comme ça !",
      "Prends le temps d'analyser le marché avant d'entrer en position.",
      "Ton capital augmente régulièrement, c'est le signe d'une bonne stratégie.",
      "N'oublie pas de définir ton stop loss avant chaque trade."
    ];

    // Notes functionality
    let notesContent = "";
    const emojis = ["😀", "😃", "😄", "😁", "😆", "😅", "😂", "🤣", "😊", "😇", "🙂", "🙃", "😉", "😌", "😍", "🥰", "😘", "😗", "😙", "😚", "😋", "😛", "😝", "😜", "🤪", "🤨", "🧐", "🤓", "😎", "🤩", "🥳", "😏", "😒", "😞", "😔", "😟", "😕", "🙁", "☹️", "😣", "😖", "😫", "😩", "🥺", "😢", "😭", "😤", "😠", "😡", "🤬", "🤯", "😳", "🥵", "🥶", "😱", "😨", "😰", "😥", "😓", "🤗", "🤔", "🤭", "🤫", "🤥", "😶", "😐", "😑", "😬", "🙄", "😯", "😦", "😧", "😮", "😲", "🥱", "😴", "🤤", "😪", "😵", "🤐", "🥴", "🤢", "🤮", "🤧", "😷", "🤒", "🤕", "🤑", "🤠", "😈", "👿", "👹", "👺", "🤡", "💩", "👻", "💀", "☠️", "👽", "👾", "🤖", "🎃", "😺", "😸", "😹", "😻", "😼", "😽", "🙀", "😿", "😾"];

    // Initialize Emoji Picker
    function initEmojiPicker() {
      const picker = document.getElementById('emojiPicker');
      picker.innerHTML = '';
      
      emojis.forEach(emoji => {
        const span = document.createElement('span');
        span.textContent = emoji;
        span.onclick = () => {
          insertTextAtCursor(emoji);
          picker.style.display = 'none';
        };
        picker.appendChild(span);
      });
    }

    // Format text in notes editor
    function formatText(format) {
      const editor = document.getElementById('notesEditor');
      const startPos = editor.selectionStart;
      const endPos = editor.selectionEnd;
      const selectedText = editor.value.substring(startPos, endPos);
      
      let formattedText = '';
      switch(format) {
        case 'bold':
          formattedText = `**${selectedText}**`;
          break;
        case 'italic':
          formattedText = `*${selectedText}*`;
          break;
        case 'underline':
          formattedText = `_${selectedText}_`;
          break;
      }
      
      editor.value = editor.value.substring(0, startPos) + formattedText + editor.value.substring(endPos);
      
      // Update preview
      updateNotesPreview();
    }

    // Insert text at cursor position
    function insertTextAtCursor(text) {
      const editor = document.getElementById('notesEditor');
      const startPos = editor.selectionStart;
      const endPos = editor.selectionEnd;
      
      editor.value = editor.value.substring(0, startPos) + text + editor.value.substring(endPos);
      
      // Set cursor position after inserted text
      editor.selectionStart = editor.selectionEnd = startPos + text.length;
      editor.focus();
      
      // Update preview
      updateNotesPreview();
    }

    // Show emoji picker
    function insertEmoji() {
      const picker = document.getElementById('emojiPicker');
      const editor = document.getElementById('notesEditor');
      
      // Position the picker near the cursor
      const rect = editor.getBoundingClientRect();
      picker.style.top = `${rect.bottom + window.scrollY}px`;
      picker.style.left = `${rect.left + window.scrollX}px`;
      
      picker.style.display = picker.style.display === 'block' ? 'none' : 'block';
    }

    // Update notes preview
    function updateNotesPreview() {
      const editor = document.getElementById('notesEditor');
      const preview = document.getElementById('notesPreview');
      
      // Simple markdown-like formatting
      let content = editor.value
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/_(.*?)_/g, '<u>$1</u>')
        .replace(/\n/g, '<br>');
      
      preview.innerHTML = content;
    }

    // Clear notes
    function clearNotes() {
      if (confirm(currentLanguage === 'fr' ? 'Voulez-vous vraiment effacer toutes vos notes ?' : 'Do you really want to clear all your notes?')) {
        document.getElementById('notesEditor').value = '';
        document.getElementById('notesPreview').innerHTML = '';
        notesContent = '';
        
        if (currentUser) {
          saveNotesToFirestore('');
        } else {
          localStorage.setItem('tradingNotes', '');
        }
      }
    }

    // Save notes to Firestore
    function saveNotesToFirestore(content) {
      if (!currentUser) return;
      
      db.collection('users').doc(currentUser.uid).set({
        notes: content,
        notesUpdatedAt: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge: true })
      .then(() => {
        console.log(currentLanguage === 'fr' ? 'Notes sauvegardées avec succès' : 'Notes saved successfully');
      })
      .catch(error => {
        console.error("Error saving notes: ", error);
      });
    }

    // Save notes
    function saveNotes() {
      notesContent = document.getElementById('notesEditor').value;
      
      if (currentUser) {
        saveNotesToFirestore(notesContent);
        alert(currentLanguage === 'fr' ? 'Notes sauvegardées avec succès !' : 'Notes saved successfully!');
      } else {
        localStorage.setItem('tradingNotes', notesContent);
        alert(currentLanguage === 'fr' ? 'Notes sauvegardées localement' : 'Notes saved locally');
      }
    }

    // Load notes
    function loadNotes() {
      if (currentUser) {
        db.collection('users').doc(currentUser.uid).get()
          .then(doc => {
            if (doc.exists && doc.data().notes) {
              notesContent = doc.data().notes;
              document.getElementById('notesEditor').value = notesContent;
              updateNotesPreview();
            }
          })
          .catch(error => {
            console.error("Error loading notes: ", error);
          });
      } else {
        notesContent = localStorage.getItem('tradingNotes') || '';
        document.getElementById('notesEditor').value = notesContent;
        updateNotesPreview();
      }
    }

    // Initialisation du calendrier
    function initCalendar() {
      const calendarEl = document.getElementById('calendar');
      
      if (!calendarEl) return;
      
      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: currentLanguage === 'fr' ? 'fr' : 'en',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: function(fetchInfo, successCallback, failureCallback) {
          if (!currentUser) {
            failureCallback(new Error('User not logged in'));
            return;
          }
          
          // Convert trades to calendar events
          const events = trades.map(trade => {
            return {
              title: `${trade.symbol} (${trade.type}) - $${Math.abs(trade.pl).toFixed(2)}`,
              start: trade.date,
              allDay: true,
              className: trade.result === 'win' ? 'win-event' : 'loss-event',
              extendedProps: {
                tradeData: trade
              }
            };
          });
          
          successCallback(events);
        },
        eventClick: function(info) {
          const trade = info.event.extendedProps.tradeData;
          const resultText = trade.result === 'win' ? (currentLanguage === 'fr' ? 'Gagné' : 'Win') : (currentLanguage === 'fr' ? 'Perdu' : 'Loss');
          
          const content = `
            <div style="padding: 10px;">
              <h4>${trade.symbol} - ${trade.type}</h4>
              <p><strong>Date:</strong> ${trade.date}</p>
              <p><strong>Entry:</strong> ${trade.entry.toFixed(4)}</p>
              <p><strong>Exit:</strong> ${trade.exit.toFixed(4)}</p>
              <p><strong>Lot:</strong> ${trade.lot.toFixed(2)}</p>
              <p><strong>Result:</strong> <span class="${trade.result}">${resultText}</span></p>
              <p><strong>P&L:</strong> <span class="${trade.result === 'win' ? 'profit' : 'loss'}">${trade.result === 'win' ? '+' : '-'}$${Math.abs(trade.pl).toFixed(2)}</span></p>
              <p><strong>R/R Ratio:</strong> ${trade.rrr.toFixed(2)}</p>
            </div>
          `;
          
          const modal = new bootstrap.Modal(document.getElementById('tradeModal'));
          document.getElementById('tradeModalBody').innerHTML = content;
          modal.show();
        },
        datesSet: function(dateInfo) {
          // You could add logic here to load trades for the visible date range
        }
      });
      
      calendar.render();
      window.tradingCalendar = calendar;
    }

    // Mettre à jour le calendrier
    function updateCalendar() {
      if (window.tradingCalendar) {
        window.tradingCalendar.refetchEvents();
      }
    }

    // Auth Functions
    function showAuthModal() {
      document.getElementById('authModal').style.display = 'flex';
    }

    function hideAuthModal() {
      document.getElementById('authModal').style.display = 'none';
      document.getElementById('loginError').textContent = '';
      document.getElementById('registerError').textContent = '';
    }

    function showResetModal() {
      document.getElementById('authModal').style.display = 'none';
      document.getElementById('resetModal').style.display = 'flex';
    }

    function hideResetModal() {
      document.getElementById('resetModal').style.display = 'none';
      document.getElementById('resetError').textContent = '';
    }

    function showLoginView() {
      document.getElementById('loginView').style.display = 'block';
      document.getElementById('registerView').style.display = 'none';
    }

    function showRegisterView() {
      document.getElementById('loginView').style.display = 'none';
      document.getElementById('registerView').style.display = 'block';
    }

    function registerUser(email, password) {
      const username = document.getElementById('registerUsername').value;
      
      if (!username) {
        document.getElementById('registerError').textContent = currentLanguage === 'fr' 
          ? 'Veuillez entrer un nom d\'utilisateur' 
          : 'Please enter a username';
        return;
      }

      auth.createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
          // User registered successfully
          currentUser = userCredential.user;
          
          // Create user data in Firestore
          return db.collection('users').doc(userCredential.user.uid).set({
            username: username,
            email: userCredential.user.email,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            initialCapital: 1000,
            darkMode: true,
            currentLanguage: 'fr',
            lastDailyFeedbackDate: null
          });
        })
        .then(() => {
          hideAuthModal();
          showWelcomeMessage(currentUser.email, true);
          loadUserData();
        })
        .catch((error) => {
          document.getElementById('registerError').textContent = error.message;
        });
    }

    function loginUser(email, password) {
      auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          // User logged in successfully
          currentUser = userCredential.user;
          hideAuthModal();
          showWelcomeMessage(currentUser.email, false);
          loadUserData();
        })
        .catch((error) => {
          document.getElementById('loginError').textContent = error.message;
        });
    }

    function resetPassword(email) {
      auth.sendPasswordResetEmail(email)
        .then(() => {
          alert(currentLanguage === 'fr' 
            ? 'Un email de réinitialisation a été envoyé. Vérifiez votre boîte de réception.' 
            : 'A reset email has been sent. Please check your inbox.');
          hideResetModal();
          showAuthModal();
        })
        .catch((error) => {
          document.getElementById('resetError').textContent = error.message;
        });
    }

    function logoutUser() {
      auth.signOut().then(() => {
        currentUser = null;
        document.getElementById('mainApp').style.display = 'none';
        document.getElementById('splash').style.display = 'flex';
        showAuthModal();
      });
    }

    function showWelcomeMessage(email, isNewUser) {
      const welcomeTitle = document.getElementById('welcomeTitle');
      const welcomeText = document.getElementById('welcomeText');
      
      if (isNewUser) {
        welcomeTitle.textContent = currentLanguage === 'fr' ? 'Bienvenue !' : 'Welcome!';
        welcomeText.textContent = currentLanguage === 'fr' 
          ? `Votre compte a été créé avec succès. Vous êtes maintenant connecté en tant que ${email}.` 
          : `Your account has been created successfully. You are now logged in as ${email}.`;
      } else {
        welcomeTitle.textContent = currentLanguage === 'fr' ? 'Content de vous revoir !' : 'Welcome back!';
        welcomeText.textContent = currentLanguage === 'fr' 
          ? `Vous êtes maintenant connecté en tant que ${email}.` 
          : `You are now logged in as ${email}.`;
      }
      
      document.getElementById('welcomeMessage').style.display = 'block';
    }

    function toggleLoggedUI(isLoggedIn) {
      // Show/hide dashboard content
      document.getElementById('nonLoggedMessage').style.display = isLoggedIn ? 'none' : 'block';
      document.getElementById('loggedContent').style.display = isLoggedIn ? 'block' : 'none';
      
      // Show/hide performance content
      document.getElementById('nonLoggedMessagePerformance').style.display = isLoggedIn ? 'none' : 'block';
      document.getElementById('loggedContentPerformance').style.display = isLoggedIn ? 'block' : 'none';
      
      // Show/hide calendar content
      document.getElementById('nonLoggedMessageCalendar').style.display = isLoggedIn ? 'none' : 'block';
      document.getElementById('loggedContentCalendar').style.display = isLoggedIn ? 'block' : 'none';
      
      // Show/hide notes content
      document.getElementById('nonLoggedMessageNotes').style.display = isLoggedIn ? 'none' : 'block';
      document.getElementById('loggedContentNotes').style.display = isLoggedIn ? 'block' : 'none';
      
      // Show/hide settings content
      document.getElementById('nonLoggedMessageSettings').style.display = isLoggedIn ? 'none' : 'block';
      document.getElementById('loggedContentSettings').style.display = isLoggedIn ? 'block' : 'none';
      
      // Show/hide brokers content
      document.getElementById('nonLoggedMessageBrokers').style.display = isLoggedIn ? 'none' : 'block';
      document.getElementById('loggedContentBrokers').style.display = isLoggedIn ? 'block' : 'none';
      
      // Show/hide user info
      document.querySelector('.user-info').style.display = isLoggedIn ? 'flex' : 'none';
      
      // Initialize calendar if logged in
      if (isLoggedIn) {
        initCalendar();
      }
    }

    function loadUserData() {
      if (!currentUser) {
        toggleLoggedUI(false);
        return;
      }

      // Update UI with user info
      const userRef = db.collection('users').doc(currentUser.uid);
      
      userRef.get().then((doc) => {
        if (doc.exists) {
          const userData = doc.data();
          
          // Update username display
          const username = userData.username || userData.email.split('@')[0];
          document.getElementById('userName').textContent = username;
          document.getElementById('userNameDisplay').textContent = username;
          document.getElementById('userEmailDisplay').textContent = userData.email;
          
          // Load user settings
          initialCapital = userData.initialCapital || 1000;
          lastDailyFeedbackDate = userData.lastDailyFeedbackDate || null;
          darkMode = userData.darkMode !== false;
          currentLanguage = userData.currentLanguage || 'fr';
          
          // Update UI
          document.getElementById('initialCapital').value = initialCapital;
          document.getElementById('initialCapitalSetting').value = initialCapital;
          document.getElementById('darkModeToggle').checked = darkMode;
          
          // Apply dark mode if needed
          if (darkMode) {
            document.body.classList.add('dark-mode');
          } else {
            document.body.classList.remove('dark-mode');
          }
          
          document.querySelectorAll('.language-option').forEach(opt => {
            opt.classList.remove('active');
            if (opt.getAttribute('data-lang') === currentLanguage) {
              opt.classList.add('active');
            }
          });
          
          // Load trades from subcollection
          return userRef.collection('trades').orderBy('date', 'desc').get();
        } else {
          // Create user document if it doesn't exist
          const username = currentUser.email.split('@')[0];
          return userRef.set({
            username: username,
            email: currentUser.email,
            initialCapital: 1000,
            darkMode: true,
            currentLanguage: 'fr',
            lastDailyFeedbackDate: null
          }).then(() => {
            // Update username display
            document.getElementById('userName').textContent = username;
            document.getElementById('userNameDisplay').textContent = username;
            document.getElementById('userEmailDisplay').textContent = currentUser.email;
            
            return userRef.collection('trades').get(); // Returns empty collection
          });
        }
      }).then((querySnapshot) => {
        const table = document.querySelector("#tradeTable tbody");
        table.innerHTML = '';
        trades = [];
        
        querySnapshot.forEach((doc) => {
          const trade = doc.data();
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${trade.date}</td>
            <td>${trade.symbol}</td>
            <td><span class="badge ${trade.type.toLowerCase()}">${trade.type}</span></td>
            <td>${trade.entry.toFixed(4)}</td>
            <td>${trade.exit.toFixed(4)}</td>
            <td>${trade.lot.toFixed(2)}</td>
            <td><span class="badge ${trade.result}">${trade.result === 'win' ? (currentLanguage === 'fr' ? 'Gagné' : 'Win') : (currentLanguage === 'fr' ? 'Perdu' : 'Loss')}</span></td>
            <td class="${trade.result === 'win' ? 'profit' : 'loss'}">${trade.result === 'win' ? '+' : '-'}${Math.abs(trade.pl).toFixed(2)}</td>
            <td>${trade.rrr.toFixed(2)}</td>
            <td><i class="fas fa-trash" onclick="deleteTrade('${doc.id}')" style="cursor:pointer;color:#f87171;"></i></td>
          `;
          table.appendChild(row);
          trades.push(trade);
        });
        
        allTrades = [...trades];
        
        // Update stats
        updateStats();
        updatePerformanceStats();
        generateDailyFeedback();
        initCalendar();
        
        // Load notes after everything else
        loadNotes();
      }).catch((error) => {
        console.error("Error loading data:", error);
      });
      
      toggleLoggedUI(true);
    }

    function saveUserData() {
      if (!currentUser) return;
      
      const userRef = db.collection('users').doc(currentUser.uid);
      
      // Prepare data to save
      const userData = {
        initialCapital: initialCapital,
        lastDailyFeedbackDate: lastDailyFeedbackDate,
        darkMode: darkMode,
        currentLanguage: currentLanguage,
        email: currentUser.email,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      
      userRef.set(userData, { merge: true })
        .then(() => {
          const message = currentLanguage === 'fr' 
            ? 'Préférences sauvegardées avec succès !' 
            : 'Preferences saved successfully!';
          console.log(message);
        })
        .catch((error) => {
          console.error("Error saving user data:", error);
          alert(currentLanguage === 'fr' 
            ? 'Erreur lors de la sauvegarde' 
            : 'Error saving data');
        });
    }

    // Sauvegarder le journal complet
    function saveJournal() {
      if (currentUser) {
        saveUserData();
        alert(currentLanguage === 'fr' 
          ? 'Journal sauvegardé avec succès !' 
          : 'Journal saved successfully!');
      } else {
        const message = currentLanguage === 'fr' 
          ? 'Veuillez vous connecter pour sauvegarder' 
          : 'Please login to save';
        alert(message);
        showAuthModal();
      }
    }

    // Réinitialiser le journal
    function resetJournal() {
      const confirmMsg = currentLanguage === 'fr' 
        ? 'Êtes-vous sûr de vouloir réinitialiser tout le journal ? Toutes les données seront perdues.' 
        : 'Are you sure you want to reset the entire journal? All data will be lost.';
      
      if (confirm(confirmMsg)) {
        // Réinitialiser les trades
        document.querySelector("#tradeTable tbody").innerHTML = '';
        
        // Réinitialiser les paramètres par défaut
        initialCapital = 1000;
        document.getElementById('initialCapital').value = initialCapital;
        document.getElementById('initialCapitalSetting').value = initialCapital;
        
        if (currentUser) {
          // Delete all trades from Firestore
          const batch = db.batch();
          const tradesRef = db.collection('users').doc(currentUser.uid).collection('trades');
          
          return tradesRef.get().then((querySnapshot) => {
            querySnapshot.forEach((doc) => {
              batch.delete(doc.ref);
            });
            return batch.commit();
          }).then(() => {
            // Update user settings
            return saveUserData();
          }).then(() => {
            // Réinitialiser les graphiques
            updateCharts();
            updatePerformanceStats();
            updateCalendar();
            
            // Afficher un message
            const message = currentLanguage === 'fr' 
              ? 'Journal réinitialisé avec succès !' 
              : 'Journal reset successfully!';
            alert(message);
          });
        } else {
          localStorage.setItem('initialCapital', initialCapital);
          
          // Réinitialiser les graphiques
          updateCharts();
          updatePerformanceStats();
          updateCalendar();
          
          // Afficher un message
          const message = currentLanguage === 'fr' 
            ? 'Journal réinitialisé avec succès !' 
            : 'Journal reset successfully!';
          alert(message);
        }
      }
    }

    // Afficher le prochain pattern émotionnel
    function showNextEmotionalPattern() {
      emotionalPatternIndex = (emotionalPatternIndex + 1) % emotionalPatterns.length;
      document.getElementById('emotionalPatternText').textContent = emotionalPatterns[emotionalPatternIndex];
    }

    // Générer un feedback quotidien basé sur les performances
    function generateDailyFeedback() {
      const today = new Date().toISOString().split('T')[0];
      
      // Ne générer qu'un feedback par jour
      if (lastDailyFeedbackDate === today) return;
      
      lastDailyFeedbackDate = today;
      
      if (currentUser) {
        saveUserData();
      } else {
        localStorage.setItem('lastDailyFeedbackDate', today);
      }
      
      // Sélectionner un feedback aléatoire ou basé sur les performances
      let feedback;
      if (trades.length === 0) {
        feedback = "Commence par ajouter tes premiers trades pour obtenir des analyses personnalisées.";
      } else {
        const winRate = parseFloat(document.getElementById('winRate').textContent);
        const avgRR = parseFloat(document.getElementById('averageRRR').textContent);
        
        if (winRate < 40) {
          feedback = "Ton win rate est bas. Revois tes critères d'entrée ou tes stops.";
        } else if (winRate > 60) {
          feedback = "Excellent win rate ! Continue à appliquer ta stratégie avec discipline.";
        } else if (avgRR < 1) {
          feedback = "Ton ratio risk/reward moyen est faible. Essaye de viser des trades avec un meilleur potentiel.";
        } else {
          // Sélectionner un feedback aléatoire parmi les options restantes
          const randomIndex = Math.floor(Math.random() * dailyFeedbacks.length);
          feedback = dailyFeedbacks[randomIndex];
        }
      }
      
      document.getElementById('dailyFeedbackText').textContent = feedback;
    }

    // Initialisation des graphiques
    function initCharts() {
      const capitalCtx = document.getElementById('capitalChart').getContext('2d');
      capitalChart = new Chart(capitalCtx, {
        type: 'line',
        data: { 
          labels: [],
          datasets: [{
            label: 'Capital',
            data: [],
            backgroundColor: 'rgba(67, 97, 238, 0.1)',
            borderColor: '#4361ee',
            borderWidth: 2,
            tension: 0.1,
            fill: true
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            annotation: {
              annotations: {
                line1: {
                  type: 'line',
                  yMin: initialCapital,
                  yMax: initialCapital,
                  borderColor: 'rgb(255, 99, 132)',
                  borderWidth: 2,
                  borderDash: [6, 6],
                  label: {
                    content: 'Capital initial',
                    enabled: true,
                    position: 'right'
                  }
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: false
            }
          }
        }
      });
      
      const pieCtx = document.getElementById('pieChart').getContext('2d');
      pieChart = new Chart(pieCtx, {
        type: 'doughnut',
        data: { 
          labels: ['Gagnants', 'Perdants'], 
          datasets: [{
            data: [0, 0],
            backgroundColor: ['#4ade80', '#f87171'],
            borderColor: ['rgba(255,255,255,0.8)', 'rgba(255,255,255,0.8)'],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' }
          },
          cutout: '70%'
        }
      });
      
      const dailyCtx = document.getElementById('dailyChart').getContext('2d');
      dailyChart = new Chart(dailyCtx, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [{
            label: 'Profit par jour',
            data: [],
            backgroundColor: [],
            borderColor: [],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: false
            }
          }
        }
      });
    }

    // Sauvegarder un trade
    function saveTrade() {
      if (!currentUser) {
        alert(currentLanguage === 'fr' 
          ? 'Veuillez vous connecter pour enregistrer des trades' 
          : 'Please login to save trades');
        showAuthModal();
        return;
      }

      const date = document.getElementById('tradeDate').value;
      const symbol = document.getElementById('tradeSymbol').value.toUpperCase();
      const type = document.getElementById('tradeType').value;
      const entry = parseFloat(document.getElementById('tradeEntry').value) || 0;
      const exit = parseFloat(document.getElementById('tradeExit').value) || 0;
      const lot = parseFloat(document.getElementById('tradeLot').value) || 0;
      const result = document.getElementById('tradeResult').value;
      let pl = parseFloat(document.getElementById('tradePL').value) || 0;
      
      if (!date || !symbol || lot < 0.01) {
        alert(currentLanguage === 'fr' ? 'Veuillez remplir tous les champs requis (date, symbole, lot minimum 0.01)' : 'Please fill all required fields (date, symbol, minimum lot 0.01)');
        return;
      }
      
      // Calcul du R/R ratio
      const rr = calculateRR(entry, exit, result, pl);
      
      // Ajuster le P&L en fonction du résultat
      if (result === 'win' && pl < 0) pl = Math.abs(pl);
      if (result === 'loss' && pl > 0) pl = -pl;
      
      const tradeData = {
        date: date,
        symbol: symbol,
        type: type,
        entry: entry,
        exit: exit,
        lot: lot,
        result: result,
        pl: pl,
        rrr: rr,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      
      // Add to Firestore
      db.collection('users').doc(currentUser.uid).collection('trades').add(tradeData)
        .then((docRef) => {
          // Add to table
          const table = document.querySelector("#tradeTable tbody");
          const row = document.createElement("tr");
          
          // Format date for display
          const displayDate = new Date(date).toLocaleDateString(currentLanguage === 'fr' ? 'fr-FR' : 'en-US');
          
          row.innerHTML = `
            <td>${displayDate}</td>
            <td>${symbol}</td>
            <td><span class="badge ${type.toLowerCase()}">${type}</span></td>
            <td>${entry.toFixed(4)}</td>
            <td>${exit.toFixed(4)}</td>
            <td>${lot.toFixed(2)}</td>
            <td><span class="badge ${result}">${result === 'win' ? (currentLanguage === 'fr' ? 'Gagné' : 'Win') : (currentLanguage === 'fr' ? 'Perdu' : 'Loss')}</span></td>
            <td class="${result === 'win' ? 'profit' : 'loss'}">${result === 'win' ? '+' : '-'}${Math.abs(pl).toFixed(2)}</td>
            <td>${rr.toFixed(2)}</td>
            <td><i class="fas fa-trash" onclick="deleteTrade('${docRef.id}')" style="cursor:pointer;color:#f87171;"></i></td>
          `;
          
          table.appendChild(row);
          
          // Clear form
          document.getElementById('tradeDate').value = '';
          document.getElementById('tradeSymbol').value = '';
          document.getElementById('tradeEntry').value = '';
          document.getElementById('tradeExit').value = '';
          document.getElementById('tradeLot').value = '';
          document.getElementById('tradePL').value = '';
          document.getElementById('tradeRR').value = '';
          
          // Update stats
          trades.push(tradeData);
          allTrades = [...trades];
          updateStats();
          updatePerformanceStats();
          generateDailyFeedback();
          updateCalendar();
        })
        .catch((error) => {
          console.error("Error adding trade: ", error);
          alert(currentLanguage === 'fr' ? 'Erreur lors de l\'ajout du trade' : 'Error adding trade');
        });
    }
    
    // Calcul du Risk/Reward ratio
    function calculateRR(entry, exit, result, pl) {
      if (result === 'win') {
        const risk = Math.abs(entry - (exit - pl));
        const reward = Math.abs(pl);
        return reward / risk;
      } else {
        const risk = Math.abs(pl);
        const reward = Math.abs(entry - (exit + pl));
        return reward / risk;
      }
    }

    // Supprimer un trade
    function deleteTrade(tradeId) {
      const confirmMsg = currentLanguage === 'fr' ? 'Voulez-vous vraiment supprimer ce trade ?' : 'Do you really want to delete this trade?';
      if (confirm(confirmMsg)) {
        if (currentUser) {
          // Delete from Firestore
          db.collection('users').doc(currentUser.uid).collection('trades').doc(tradeId).delete()
            .then(() => {
              // Remove from table
              const rows = document.querySelectorAll("#tradeTable tbody tr");
              for (let i = 0; i < rows.length; i++) {
                const trashIcon = rows[i].querySelector(".fa-trash");
                if (trashIcon && trashIcon.getAttribute('onclick').includes(tradeId)) {
                  rows[i].remove();
                  break;
                }
              }
              
              // Update trades array
              trades = trades.filter(trade => trade.id !== tradeId);
              allTrades = [...trades];
              
              // Update stats
              updateStats();
              updatePerformanceStats();
              generateDailyFeedback();
              updateCalendar();
            })
            .catch((error) => {
              console.error("Error removing trade: ", error);
              alert(currentLanguage === 'fr' ? 'Erreur lors de la suppression' : 'Error deleting trade');
            });
        } else {
          // For non-logged users, just remove from table
          const rows = document.querySelectorAll("#tradeTable tbody tr");
          for (let i = 0; i < rows.length; i++) {
            const trashIcon = rows[i].querySelector(".fa-trash");
            if (trashIcon && trashIcon.getAttribute('onclick').includes(tradeId)) {
              rows[i].remove();
              break;
            }
          }
          
          // Update trades array
          trades = trades.filter(trade => trade.id !== tradeId);
          allTrades = [...trades];
          
          // Update stats
          updateStats();
          updatePerformanceStats();
          generateDailyFeedback();
          updateCalendar();
        }
      }
    }

    // Mise à jour des statistiques
    function updateStats() {
      const rows = document.querySelectorAll("#tradeTable tbody tr");
      let totalGain = 0;
      let wins = 0;
      let totalRRR = 0;

      trades.forEach(trade => {
        totalGain += trade.pl;
        totalRRR += trade.rrr;
        if (trade.result === 'win') wins++;
      });

      // Mise à jour des statistiques
      const avgRRR = trades.length ? totalRRR / trades.length : 0;
      const winRate = trades.length ? (wins / trades.length) * 100 : 0;

      document.getElementById("totalTrades").textContent = trades.length;
      document.getElementById("winRate").textContent = `${winRate.toFixed(1)}%`;
      document.getElementById("totalProfit").textContent = `$${totalGain.toFixed(2)}`;
      document.getElementById("averageRRR").textContent = avgRRR.toFixed(2);
      document.getElementById("currentCapital").textContent = `$${(parseFloat(initialCapital) + totalGain).toFixed(2)}`;

      // Mise à jour des graphiques
      updateCharts();
    }
    
    // Mise à jour des statistiques de performance
    function updatePerformanceStats() {
      if (trades.length === 0) {
        document.getElementById("avgRiskReward").textContent = "0";
        document.getElementById("maxDrawdown").textContent = "$0";
        document.getElementById("maxDailyLoss").textContent = "$0";
        document.getElementById("maxDailyWin").textContent = "$0";
        return;
      }
      
      // Calcul du Risk/Reward moyen
      const avgRR = trades.reduce((sum, trade) => sum + trade.rrr, 0) / trades.length;
      document.getElementById("avgRiskReward").textContent = avgRR.toFixed(2);
      
      // Calcul du Max Drawdown
      let balance = parseFloat(initialCapital);
      let peak = balance;
      let maxDrawdown = 0;
      
      // Trier les trades par date
      const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
      
      // Calcul des pertes/par jour
      const dailyResults = {};
      sortedTrades.forEach(trade => {
        const date = trade.date;
        if (!dailyResults[date]) {
          dailyResults[date] = 0;
        }
        dailyResults[date] += trade.pl;
      });
      
      // Trouver le max loss/jour et max win/jour
      let maxDailyLoss = 0;
      let maxDailyWin = 0;
      
      Object.values(dailyResults).forEach(pl => {
        if (pl < maxDailyLoss) maxDailyLoss = pl;
        if (pl > maxDailyWin) maxDailyWin = pl;
      });
      
      // Calcul du drawdown
      sortedTrades.forEach(trade => {
        balance += trade.pl;
        if (balance > peak) peak = balance;
        const drawdown = peak - balance;
        if (drawdown > maxDrawdown) maxDrawdown = drawdown;
      });
      
      document.getElementById("maxDrawdown").textContent = `$${maxDrawdown.toFixed(2)}`;
      document.getElementById("maxDailyLoss").textContent = `$${maxDailyLoss.toFixed(2)}`;
      document.getElementById("maxDailyWin").textContent = `$${maxDailyWin.toFixed(2)}`;
      
      // Mise à jour du graphique quotidien
      updateDailyChart();
    }

    // Mise à jour des graphiques
    function updateCharts() {
      const wins = trades.filter(t => t.result === 'win').length;
      const losses = trades.length - wins;
      
      pieChart.data.datasets[0].data = [wins, losses];
      pieChart.update();
      
      // Mise à jour du graphique de capital
      updateCapitalChart();
    }
    
    // Mise à jour du graphique de capital
    function updateCapitalChart() {
      if (trades.length === 0) {
        capitalChart.data.labels = [];
        capitalChart.data.datasets[0].data = [initialCapital];
        capitalChart.update();
        return;
      }
      
      // Trier les trades par date
      const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
      
      // Créer un tableau de balances par date
      const dates = [];
      const balances = [];
      let balance = parseFloat(initialCapital);
      
      // Ajouter le point de départ
      dates.push("Départ");
      balances.push(balance);
      
      sortedTrades.forEach(trade => {
        balance += trade.pl;
        dates.push(new Date(trade.date).toLocaleDateString(currentLanguage === 'fr' ? 'fr-FR' : 'en-US'));
        balances.push(balance);
      });
      
      capitalChart.data.labels = dates;
      capitalChart.data.datasets[0].data = balances;
      capitalChart.update();
    }
    
    // Mise à jour du graphique quotidien
    function updateDailyChart() {
      if (trades.length === 0) {
        dailyChart.data.labels = [];
        dailyChart.data.datasets[0].data = [];
        dailyChart.data.datasets[0].backgroundColor = [];
        dailyChart.data.datasets[0].borderColor = [];
        dailyChart.update();
        return;
      }
      
      // Calculer le profit par jour
      const dailyProfit = {};
      
      trades.forEach(trade => {
        if (!dailyProfit[trade.date]) {
          dailyProfit[trade.date] = 0;
        }
        dailyProfit[trade.date] += trade.pl;
      });
      
      // Trier par date
      const sortedDates = Object.keys(dailyProfit).sort((a, b) => new Date(a) - new Date(b));
      const dailyLabels = sortedDates.map(date => new Date(date).toLocaleDateString(currentLanguage === 'fr' ? 'fr-FR' : 'en-US'));
      const dailyData = sortedDates.map(date => dailyProfit[date]);
      
      // Créer des couleurs en fonction du profit (vert/rouge)
      const backgroundColors = dailyData.map(profit => 
        profit >= 0 ? 'rgba(74, 222, 128, 0.7)' : 'rgba(248, 113, 113, 0.7)'
      );
      const borderColors = dailyData.map(profit => 
        profit >= 0 ? 'rgba(74, 222, 128, 1)' : 'rgba(248, 113, 113, 1)'
      );
      
      dailyChart.data.labels = dailyLabels;
      dailyChart.data.datasets[0].data = dailyData;
      dailyChart.data.datasets[0].backgroundColor = backgroundColors;
      dailyChart.data.datasets[0].borderColor = borderColors;
      dailyChart.update();
    }

    // Filtrer les trades
    function filterTrades() {
      const symbolFilter = document.getElementById('symbolFilter').value.toLowerCase();
      const dateFrom = document.getElementById('dateFromFilter').value;
      const dateTo = document.getElementById('dateToFilter').value;
      const resultFilter = document.getElementById('resultFilter').value;
      
      const rows = document.querySelectorAll("#tradeTable tbody tr");
      
      rows.forEach(row => {
        const symbol = row.querySelector("td:nth-child(2)").textContent.toLowerCase();
        const date = row.querySelector("td:nth-child(1)").textContent;
        const result = row.querySelector("td:nth-child(7) span").textContent;
        
        const symbolMatch = symbol.includes(symbolFilter);
        const dateMatch = (!dateFrom || new Date(date) >= new Date(dateFrom)) && 
                         (!dateTo || new Date(date) <= new Date(dateTo));
        const resultMatch = resultFilter === 'all' || 
                          (resultFilter === 'win' && (result === 'Gagné' || result === 'Win')) || 
                          (resultFilter === 'loss' && (result === 'Perdu' || result === 'Loss'));
        
        row.style.display = symbolMatch && dateMatch && resultMatch ? "" : "none";
      });
    }
    
    // Mettre à jour le capital initial
    function updateCapital() {
      const newCapital = parseFloat(document.getElementById('initialCapital').value) || 1000;
      initialCapital = newCapital;
      
      if (currentUser) {
        saveUserData();
      } else {
        localStorage.setItem('initialCapital', newCapital);
      }
      
      updateStats();
      updateCapitalChart();
      generateDailyFeedback();
      
      alert(currentLanguage === 'fr' ? 'Capital initial mis à jour' : 'Initial capital updated');
    }

    // Mettre à jour le capital depuis les paramètres
    function updateCapitalFromSettings() {
      const newCapital = parseFloat(document.getElementById('initialCapitalSetting').value) || 1000;
      initialCapital = newCapital;
      document.getElementById('initialCapital').value = newCapital;
      
      if (currentUser) {
        saveUserData();
      } else {
        localStorage.setItem('initialCapital', newCapital);
      }
      
      updateStats();
      updateCapitalChart();
      generateDailyFeedback();
      
      alert(currentLanguage === 'fr' ? 'Capital initial mis à jour' : 'Initial capital updated');
    }
    
    // Exporter vers CSV
    function exportToCSV() {
      if (trades.length === 0) {
        alert(currentLanguage === 'fr' ? 'Aucun trade à exporter' : 'No trades to export');
        return;
      }
      
      let csv = 'Date,Symbole,Type,Entry,Exit,Lot,Resultat,P&L,R/R Ratio\n';
      
      trades.forEach(trade => {
        csv += `"${trade.date}",${trade.symbol},${trade.type},${trade.entry},${trade.exit},${trade.lot},${trade.result},${trade.pl},${trade.rrr}\n`;
      });
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      
      link.setAttribute('href', url);
      link.setAttribute('download', `trading_journal_${new Date().toISOString().slice(0,10)}.csv`);
      link.style.visibility = 'hidden';
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    
    // Exporter vers Excel
    function exportToExcel() {
      if (trades.length === 0) {
        alert(currentLanguage === 'fr' ? 'Aucun trade à exporter' : 'No trades to export');
        return;
      }
      
      const wb = XLSX.utils.book_new();
      const wsData = [
        ['Date', 'Symbole', 'Type', 'Entry', 'Exit', 'Lot', 'Resultat', 'P&L', 'R/R Ratio'],
        ...trades.map(trade => [
          trade.date,
          trade.symbol,
          trade.type,
          trade.entry,
          trade.exit,
          trade.lot,
          trade.result,
          trade.pl,
          trade.rrr
        ])
      ];
      
      const ws = XLSX.utils.aoa_to_sheet(wsData);
      XLSX.utils.book_append_sheet(wb, ws, 'Trading Journal');
      XLSX.writeFile(wb, `trading_journal_${new Date().toISOString().slice(0,10)}.xlsx`);
    }
    
    // Importer depuis un fichier
    function importFromFile() {
      if (!currentUser) {
        alert(currentLanguage === 'fr' 
          ? 'Veuillez vous connecter pour importer des trades' 
          : 'Please login to import trades');
        showAuthModal();
        return;
      }
      document.getElementById('fileInput').click();
    }
    
    // Gérer l'import de fichier
    function handleFileImport(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        
        // Prendre la première feuille
        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(worksheet);
        
        if (jsonData.length === 0) {
          alert(currentLanguage === 'fr' ? 'Aucune donnée trouvée dans le fichier' : 'No data found in file');
          return;
        }
        
        // Batch write to Firestore
        const batch = db.batch();
        const tradesRef = db.collection('users').doc(currentUser.uid).collection('trades');
        
        jsonData.forEach(row => {
          const date = row.Date || row.DATE || row.date;
          const symbol = row.Symbole || row.SYMBOL || row.symbol;
          const type = row.Type || row.TYPE || row.type;
          const entry = row.Entry || row.ENTRY || row.entry;
          const exit = row.Exit || row.EXIT || row.exit;
          const lot = row.Lot || row.LOT || row.lot;
          const result = row.Resultat || row.RESULT || row.result;
          const pl = row['P&L'] || row.PL || row.pl;
          const rr = row['R/R Ratio'] || row.RR || row.rr;
          
          if (date && symbol) {
            const tradeData = {
              date: date,
              symbol: symbol.toUpperCase(),
              type: type,
              entry: parseFloat(entry),
              exit: parseFloat(exit),
              lot: parseFloat(lot),
              result: result.toLowerCase(),
              pl: result.toLowerCase() === 'win' ? Math.abs(parseFloat(pl)) : -Math.abs(parseFloat(pl)),
              rrr: parseFloat(rr),
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            const docRef = tradesRef.doc(); // Auto-generated ID
            batch.set(docRef, tradeData);
          }
        });
        
        return batch.commit().then(() => {
          // Reload data after import
          loadUserData();
          alert(currentLanguage === 'fr' ? `${jsonData.length} trades importés avec succès` : `${jsonData.length} trades imported successfully`);
        }).catch(error => {
          console.error("Error importing trades: ", error);
          alert(currentLanguage === 'fr' ? 'Erreur lors de l\'importation' : 'Error during import');
        });
      };
      
      reader.readAsArrayBuffer(file);
      e.target.value = ''; // Reset input
    }
    
    // Basculer entre dark/light mode
    function toggleDarkMode() {
      darkMode = !darkMode;
      if (darkMode) {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
      
      if (currentUser) {
        saveUserData();
      } else {
        localStorage.setItem('darkMode', darkMode);
      }
    }
    
    // Changer la langue
    function changeLanguage(lang) {
      currentLanguage = lang;
      
      if (currentUser) {
        saveUserData();
      } else {
        localStorage.setItem('tradingLanguage', lang);
      }
      
      // Mettre à jour l'interface
      translateUI();
      
      // Mettre à jour les trades existants
      updateTradesLanguage();
    }
    
    // Traduire l'interface
    function translateUI() {
      if (currentLanguage === 'fr') {
        // Traductions françaises
        document.querySelector('#dashboard-section h3').textContent = 'AJOUTER UN TRADE';
        document.querySelector('#performance-section h1').textContent = 'ANALYSE DE PERFORMANCE';
        document.querySelector('#calendar-section h1').innerHTML = '<i class="fas fa-calendar-alt"></i> CALENDRIER DES TRADES';
        document.querySelector('#brokers-section h1').textContent = 'RECOMMANDATION DE BROKERS';
        document.querySelector('#settings-section h1').textContent = 'PARAMÈTRES';
        document.querySelector('#notes-section h1').innerHTML = '<i class="fas fa-sticky-note"></i> MES NOTES';
        
        // Mettre à jour les textes des boutons, etc.
        document.querySelector('button[onclick="saveJournal()"]').innerHTML = '<i class="fas fa-save"></i> Sauvegarder';
        document.querySelector('button[onclick="resetJournal()"]').innerHTML = '<i class="fas fa-trash-alt"></i> Réinitialiser';
        
        // Mettre à jour les messages non connectés
        document.querySelector('#nonLoggedMessage h2').textContent = 'Connectez-vous pour accéder à votre journal';
        document.querySelector('#nonLoggedMessage p').textContent = 'Veuillez vous connecter ou créer un compte pour enregistrer et suivre vos trades.';
        document.querySelector('#nonLoggedMessage button').textContent = 'Se connecter';
        
        document.querySelector('#nonLoggedMessagePerformance h2').textContent = 'Connectez-vous pour accéder à l\'analyse de performance';
        document.querySelector('#nonLoggedMessagePerformance p').textContent = 'Veuillez vous connecter ou créer un compte pour visualiser vos statistiques de trading.';
        document.querySelector('#nonLoggedMessagePerformance button').textContent = 'Se connecter';
        
        document.querySelector('#nonLoggedMessageCalendar h2').textContent = 'Connectez-vous pour accéder au calendrier';
        document.querySelector('#nonLoggedMessageCalendar p').textContent = 'Veuillez vous connecter ou créer un compte pour visualiser vos trades sur le calendrier.';
        document.querySelector('#nonLoggedMessageCalendar button').textContent = 'Se connecter';
        
        document.querySelector('#nonLoggedMessageNotes h2').textContent = 'Connectez-vous pour accéder aux notes';
        document.querySelector('#nonLoggedMessageNotes p').textContent = 'Veuillez vous connecter ou créer un compte pour enregistrer vos notes personnelles.';
        document.querySelector('#nonLoggedMessageNotes button').textContent = 'Se connecter';
        
        document.querySelector('#nonLoggedMessageSettings h2').textContent = 'Connectez-vous pour accéder aux paramètres';
        document.querySelector('#nonLoggedMessageSettings p').textContent = 'Veuillez vous connecter ou créer un compte pour personnaliser votre expérience.';
        document.querySelector('#nonLoggedMessageSettings button').textContent = 'Se connecter';
        
        document.querySelector('#nonLoggedMessageBrokers h2').textContent = 'Connectez-vous pour accéder aux recommandations de brokers';
        document.querySelector('#nonLoggedMessageBrokers p').textContent = 'Veuillez vous connecter ou créer un compte pour voir nos recommandations.';
        document.querySelector('#nonLoggedMessageBrokers button').textContent = 'Se connecter';
      } else {
        // English translations
        document.querySelector('#dashboard-section h3').textContent = 'ADD A TRADE';
        document.querySelector('#performance-section h1').textContent = 'PERFORMANCE ANALYSIS';
        document.querySelector('#calendar-section h1').innerHTML = '<i class="fas fa-calendar-alt"></i> TRADING CALENDAR';
        document.querySelector('#brokers-section h1').textContent = 'BROKER RECOMMENDATIONS';
        document.querySelector('#settings-section h1').textContent = 'SETTINGS';
        document.querySelector('#notes-section h1').innerHTML = '<i class="fas fa-sticky-note"></i> MY NOTES';
        
        // Update button texts
        document.querySelector('button[onclick="saveJournal()"]').innerHTML = '<i class="fas fa-save"></i> Save';
        document.querySelector('button[onclick="resetJournal()"]').innerHTML = '<i class="fas fa-trash-alt"></i> Reset';
        
        // Update non-logged messages
        document.querySelector('#nonLoggedMessage h2').textContent = 'Login to access your journal';
        document.querySelector('#nonLoggedMessage p').textContent = 'Please login or create an account to save and track your trades.';
        document.querySelector('#nonLoggedMessage button').textContent = 'Login';
        
        document.querySelector('#nonLoggedMessagePerformance h2').textContent = 'Login to access performance analysis';
        document.querySelector('#nonLoggedMessagePerformance p').textContent = 'Please login or create an account to view your trading statistics.';
        document.querySelector('#nonLoggedMessagePerformance button').textContent = 'Login';
        
        document.querySelector('#nonLoggedMessageCalendar h2').textContent = 'Login to access calendar';
        document.querySelector('#nonLoggedMessageCalendar p').textContent = 'Please login or create an account to view your trades on the calendar.';
        document.querySelector('#nonLoggedMessageCalendar button').textContent = 'Login';
        
        document.querySelector('#nonLoggedMessageNotes h2').textContent = 'Login to access notes';
        document.querySelector('#nonLoggedMessageNotes p').textContent = 'Please login or create an account to save your personal notes.';
        document.querySelector('#nonLoggedMessageNotes button').textContent = 'Login';
        
        document.querySelector('#nonLoggedMessageSettings h2').textContent = 'Login to access settings';
        document.querySelector('#nonLoggedMessageSettings p').textContent = 'Please login or create an account to customize your experience.';
        document.querySelector('#nonLoggedMessageSettings button').textContent = 'Login';
        
        document.querySelector('#nonLoggedMessageBrokers h2').textContent = 'Login to access broker recommendations';
        document.querySelector('#nonLoggedMessageBrokers p').textContent = 'Please login or create an account to see our recommendations.';
        document.querySelector('#nonLoggedMessageBrokers button').textContent = 'Login';
      }
      
      // Update calendar language if it exists
      if (window.tradingCalendar) {
        window.tradingCalendar.setOption('locale', currentLanguage === 'fr' ? 'fr' : 'en');
      }
    }
    
    // Mettre à jour la langue des trades existants
    function updateTradesLanguage() {
      const resultCells = document.querySelectorAll("#tradeTable tbody tr td:nth-child(7) span");
      
      resultCells.forEach(cell => {
        if (cell.textContent === 'Gagné' || cell.textContent === 'Win') {
          cell.textContent = currentLanguage === 'fr' ? 'Gagné' : 'Win';
        } else if (cell.textContent === 'Perdu' || cell.textContent === 'Loss') {
          cell.textContent = currentLanguage === 'fr' ? 'Perdu' : 'Loss';
        }
      });
    }

    // Initialisation
    document.addEventListener('DOMContentLoaded', () => {
      const splash = document.getElementById('splash');
      const btn = document.getElementById('enterBtn');
      const app = document.getElementById('mainApp');
      
      // Configurer les écouteurs d'authentification
      document.getElementById('showRegister').addEventListener('click', showRegisterView);
      document.getElementById('showLogin').addEventListener('click', showLoginView);
      document.getElementById('forgotPassword').addEventListener('click', showResetModal);
      document.getElementById('backToLogin').addEventListener('click', () => {
        hideResetModal();
        showAuthModal();
      });
      document.getElementById('resetBtn').addEventListener('click', () => {
        const email = document.getElementById('resetEmail').value;
        resetPassword(email);
      });
      
      document.getElementById('registerBtn').addEventListener('click', () => {
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        const confirmPassword = document.getElementById('registerConfirmPassword').value;
        
        if (password !== confirmPassword) {
          document.getElementById('registerError').textContent = currentLanguage === 'fr' 
            ? 'Les mots de passe ne correspondent pas' 
            : 'Passwords do not match';
          return;
        }
        
        registerUser(email, password);
      });
      
      document.getElementById('loginBtn').addEventListener('click', () => {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        loginUser(email, password);
      });
      
      document.getElementById('logoutBtn').addEventListener('click', logoutUser);
      
      // Écouter les changements d'état d'authentification
      auth.onAuthStateChanged((user) => {
        if (user) {
          // User is signed in
          currentUser = user;
          
          // Hide auth modal if it's visible
          hideAuthModal();
          hideResetModal();
          
          // Show the main app if splash screen is not shown
          if (splash.style.display === 'none') {
            app.style.display = 'flex';
            loadUserData();
          }
        } else {
          // User is signed out
          currentUser = null;
          toggleLoggedUI(false);
          
          // Show auth modal when splash screen is dismissed
          btn.addEventListener('click', () => {
            splash.style.display = 'none';
            showAuthModal();
          }, { once: true });
        }
      });
      
      // Configurer les boutons de login depuis l'application
      document.getElementById('loginFromAppBtn')?.addEventListener('click', showAuthModal);
      document.getElementById('loginFromPerformanceBtn')?.addEventListener('click', showAuthModal);
      document.getElementById('loginFromCalendarBtn')?.addEventListener('click', showAuthModal);
      document.getElementById('loginFromNotesBtn')?.addEventListener('click', showAuthModal);
      document.getElementById('loginFromSettingsBtn')?.addEventListener('click', showAuthModal);
      document.getElementById('loginFromBrokersBtn')?.addEventListener('click', showAuthModal);
      
      // Fermer le message de bienvenue
      document.getElementById('closeWelcomeBtn')?.addEventListener('click', function() {
        document.getElementById('welcomeMessage').style.display = 'none';
      });
      
      // Charger les préférences locales si pas connecté
      darkMode = localStorage.getItem('darkMode') !== 'false';
      if (darkMode) {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
      
      currentLanguage = localStorage.getItem('tradingLanguage') || 'fr';
      document.querySelector(`.language-option[data-lang="${currentLanguage}"]`).classList.add('active');
      
      initialCapital = parseFloat(localStorage.getItem('initialCapital')) || 1000;
      document.getElementById('initialCapital').value = initialCapital;
      document.getElementById('initialCapitalSetting').value = initialCapital;
      
      // Configurer les datepickers
      flatpickr(".date-input", {
        dateFormat: "Y-m-d",
        defaultDate: new Date()
      });
      
      flatpickr(".date-filter", {
        dateFormat: "Y-m-d"
      });
      
      // Configurer l'écouteur de fichier
      document.getElementById('fileInput').addEventListener('change', handleFileImport);
      
      // Configurer le dark mode toggle
      document.getElementById('darkModeToggle').checked = darkMode;
      document.getElementById('darkModeToggle').addEventListener('change', toggleDarkMode);
      
      // Configurer les boutons de langue
      document.querySelectorAll('.language-option').forEach(option => {
        option.addEventListener('click', function() {
          document.querySelectorAll('.language-option').forEach(opt => opt.classList.remove('active'));
          this.classList.add('active');
          changeLanguage(this.getAttribute('data-lang'));
        });
      });

      btn.addEventListener('click', () => {
        splash.style.display = 'none';
        
        if (currentUser) {
          app.style.display = 'flex';
          initCharts();
          loadUserData();
          
          // Démarrer le carrousel de patterns émotionnels
          emotionalPatternInterval = setInterval(showNextEmotionalPattern, 60000); // 60 secondes
          
          // Générer le feedback quotidien
          generateDailyFeedback();
        } else {
          showAuthModal();
        }
      });

      // Navigation
      document.querySelectorAll('.sidebar i').forEach(icon => {
        icon.addEventListener('click', function() {
          const section = this.getAttribute('data-section');
          if (section) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(section + '-section').classList.add('active');
            
            document.querySelectorAll('.sidebar i').forEach(i => 
              i.classList.remove('active'));
            this.classList.add('active');
          }
        });
      });
      
      // Auto-calculate RR when PL changes
      document.getElementById('tradePL').addEventListener('input', function() {
        const entry = parseFloat(document.getElementById('tradeEntry').value) || 0;
        const exit = parseFloat(document.getElementById('tradeExit').value) || 0;
        const result = document.getElementById('tradeResult').value;
        const pl = parseFloat(this.value) || 0;
        
        if (entry && exit && pl) {
          const rr = calculateRR(entry, exit, result, pl);
          document.getElementById('tradeRR').value = rr.toFixed(2);
        }
      });
      
      // Auto-calculate PL when Exit changes
      document.getElementById('tradeExit').addEventListener('input', function() {
        const entry = parseFloat(document.getElementById('tradeEntry').value) || 0;
        const exit = parseFloat(this.value) || 0;
        const lot = parseFloat(document.getElementById('tradeLot').value) || 0;
        const type = document.getElementById('tradeType').value;
        
        if (entry && exit && lot) {
          let pl = 0;
          if (type === 'Buy') {
            pl = (exit - entry) * lot * 100000; // Simplified calculation for forex
          } else {
            pl = (entry - exit) * lot * 100000;
          }
          
          document.getElementById('tradePL').value = Math.abs(pl).toFixed(2);
          document.getElementById('tradeResult').value = pl >= 0 ? 'win' : 'loss';
          
          // Calculate RR
          const result = document.getElementById('tradeResult').value;
          const rr = calculateRR(entry, exit, result, pl);
          document.getElementById('tradeRR').value = rr.toFixed(2);
        }
      });

      // Initialize emoji picker
      initEmojiPicker();
      
      // Update notes preview when typing
      document.getElementById('notesEditor').addEventListener('input', updateNotesPreview);
      
      // Close emoji picker when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('#emojiPicker') && !e.target.closest('[onclick="insertEmoji()"]')) {
          document.getElementById('emojiPicker').style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>